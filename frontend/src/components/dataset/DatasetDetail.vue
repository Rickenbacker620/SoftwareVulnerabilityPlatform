<template lang="pug">
div.p-20.text-4xl.leading-loose
    AnnotationArea(v-for="annotation in paragraph.annotations" :annotation="annotation")
</template>

<script setup lang="ts">
import { onMounted, Ref, ref } from "@vue/runtime-core";
import hotkeys from 'hotkeys-js'
import { AnnotationSpan, AnnotationVModel, getTextTokenIdx } from "./annotation";
import AnnotationArea from "./AnnotationArea.vue";

const text = `guestbook.pl cleanses user-inserted SSI commands by removing text between \"<!--\" and \"-->\" separators, which allows remote attackers to execute arbitrary commands when guestbook.pl is run on Apache 1.3.9 and possibly other versions, since Apache allows other closing sequences besides \"-->\".`


const paragraph = ref(new AnnotationVModel(text))

const annotation1 = new AnnotationSpan(0, 6, 'cat1')
const annotation2 = new AnnotationSpan(13, 15, 'cat2')
const annotation3 = new AnnotationSpan(8, 10, 'cat2')



// const selectArea: Ref<AnnotationSpan> = ref({ start: 0, end: 0 })

// console.log(basetext.text.slice(0, 6))
paragraph.value.addAnnotation(annotation1)
paragraph.value.addAnnotation(annotation2)
paragraph.value.addAnnotation(annotation3)


const setupKeys = () => {
    hotkeys('left', function (event, handler) {
        paragraph.value.moveLeft()
    })
    hotkeys('right', function (event, handler) {
        paragraph.value.moveRight()
    })
    hotkeys('ctrl + right', function (event, handler) {
        paragraph.value.moveRight5()
    })
    hotkeys('ctrl + left', function (event, handler) {
        paragraph.value.moveLeft5()
    })
    hotkeys('space', function (event, handler) {
        paragraph.value.hoistCursor()
    })
    hotkeys('esc', function (event, handler) {
        paragraph.value.lowerCursor()
    })
}

// annotations.push(basetext)

onMounted(setupKeys)

</script>
