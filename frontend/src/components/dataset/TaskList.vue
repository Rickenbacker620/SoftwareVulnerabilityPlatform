<template lang="pug">
div
    NDataTable(:columns="columns" :data="datasets" :row-key="(row) => row.id")
</template>

<script setup lang="ts">
import { h, ref } from "vue";
import { NButton, NIcon } from "naive-ui";
// import mockdataset from "../../utils/cveinfo.json"
import { useRoute, useRouter } from "vue-router";
import { datasetService } from "@/utils/services";
import type { DatasetSchema } from "@/api";
import { Checkbox, CheckboxChecked, Corner } from "@vicons/carbon";
import { useUserStore } from "@/stores/user";

// const nono = mockdataset.RECORDS
const nono = []
const route = useRoute()
const router = useRouter()

const user = useUserStore()

const datasets = ref()
user.taskList.push(...(await datasetService.getMyTasks()).data)
datasets.value = (await datasetService.getMyTasks())
    .data.map((e) => {
        return { ...e.dataset.cve, name: e.name, id: e.dataset.id, done: e.done }
    })

console.log(datasets.value)

const columns = [
    {
        title: '状态',
        key: 'done',
        width: 150,
        render(row: any) {
            if (row.done === true) {
                return h('div', { class: "text-green-500" }, { default: () => "已完成" })
            } else {
                return h('div', { class: "text-red-500" }, { default: () => "未完成" })
            }
            // return h(
            //     NIcon,
            //     {
            //     },
            //     { default: () => row.done ? CheckboxChecked : Checkbox }
            // )
        },
    },
    {
        title: '任务',
        key: 'name',
        width: 150
    },
    {
        title: 'CVE编号',
        key: 'cve_no',
        width: 150
    },
    {
        title: '描述',
        key: 'description',
        ellipsis: true,
    },
    {
        title: '操作',
        key: 'actions',
        render(row: any) {
            return h(
                NButton,
                {
                    size: 'small',
                    onClick: () => { router.push({ name: 'DatasetDetail', params: { id: row.id } }) }
                },
                { default: () => '标注' }
            )
        },
        ellipsis: true,
        width: 150
    }
]

</script>