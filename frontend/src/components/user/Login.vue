<template lang="pug">
div.container
    NForm.w-56.mx-auto.my-20(:model="model")
        NFormItem(label="用户名" size="large")
            NInput(placeholder="" v-model:value="model.username" )
        NFormItem(label="密码" size="large")
            NInput(type="password" placeholder="" v-model:value="model.password")
        NFormItem.flex.justify-center
            NButton(@click="login") 登录
        div {{ model.username }}
        div {{ model.password }}
</template>

<script setup lang="ts">
import { userService } from "@/utils/service";
import { reactive } from "@vue/reactivity";
import { useMessage } from "naive-ui";
import { useRouter } from "vue-router";
import { useStore } from "vuex";

const model = reactive({
    username: "",
    password: ""
})

const message = useMessage()
const router = useRouter()
const store = useStore()

const login = async () => {
    try {
        await userService.userLogin(model)
        store.state.user = (await userService.userMe()).data
        store.state.isLogin = true
        router.push('/dataset/1')
    } catch (error) {
        message.error('login fail')
    }
}

</script>