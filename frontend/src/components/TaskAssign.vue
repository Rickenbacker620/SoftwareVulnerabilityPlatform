<template lang="pug">
div.flex.flex-row.space-x-10
    NSpace(vertical)
        NSelect(v-model:value="task.users" multiple :options="options" placeholder="请选择用户")
        NRadio(:checked="task.type === 'annotate'" @change="handleChange" value="annotate" name="tasktype") 标注任务
        NRadio(:checked="task.type === 'classify'" @change="handleChange" value="classify" name="tasktype") 分类任务
        NInput(v-model:value="task.name", type="text" placeholder="请输入任务名称")
        NInputNumber( v-model:value="task.size" clearable)
        NButton(@click="handleClick") 提交
</template>

<script setup lang="ts">
import { datasetService, userService } from "@/utils/services"
import { NRadio,NInputNumber, NSelect, useMessage } from "naive-ui"
import { reactive, ref } from "vue"

const message = useMessage()

const {data:userList} = await userService.showUsers()
const options = userList.map(e => ({label:e, value:e}))

const task = reactive({
    name: "",
    size: 0,
    type: "annotate",
    users: []
})

const handleChange = (e) => task.type = e.target.value

const handleClick = async () => {
    if (task.name === "" || task.size === 0) {
        message.error("格式错误")
        return
    }
    try {
        const { data } = await datasetService.makeTask(task)
        message.success(data.message)
    } catch (error) {
        message.error(error.response.data.detail)
    }
}
</script>
