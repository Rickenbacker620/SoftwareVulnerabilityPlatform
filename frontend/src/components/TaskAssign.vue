<template lang="pug">
div.flex.flex-col.items-center.space-y-10.mx-auto(class="w-1/4")
    NInput(v-model:value="task.name", type="text" placeholder="请输入任务名称")
    NTransfer(v-model:value="task.users" :options="options" virtual-scroll filterable source-title="所有用户" target-title="已选择用户")
    div.flex.flex-row
        NRadio(:checked="task.task_type === 'annotate'" @change="handleChange" value="annotate" name="tasktype") 标注任务
        NRadio(:checked="task.task_type === 'classify'" @change="handleChange" value="classify" name="tasktype") 分类任务
    NInputNumber( v-model:value="task.size" clearable)
    NButton(@click="handleClick") 提交
</template>

<script setup lang="ts">
import { datasetService, taskService, userService } from "@/utils/services"
import { NTransfer, NRadio, NInputNumber, useMessage } from "naive-ui"
import { reactive, ref } from "vue"

const message = useMessage()

const { data: userList } = await userService.showUsers()
const options = userList.map((e) => ({ label: e, value: e }))

const task = reactive({
    name: "",
    size: 0,
    type: "annotate",
    users: [],
})

const handleChange = (e) => (task.task_type = e.target.value)

const handleClick = async () => {
    if (task.name === "" || task.size === 0) {
        message.error("格式错误")
        return
    }
    try {
        const { data } = await taskService.makeTask(task)
        message.success(data.message)
    } catch (error) {
        message.error(error.response.data.detail)
    }
}
</script>
