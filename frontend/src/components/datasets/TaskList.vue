<template lang="pug">
NCollapse(accordion)
    NCollapseItem(v-for="task in tasks" :title="task.name" :key="task.name")
        template(#header-extra) {{ task.created_at.toLocaleString("zh-CN")}}
        NList.ml-5
            NListItem.text-center(v-for="dataset in task.detail")
                template(#prefix)
                    NIcon(:color="(dataset.annotated || dataset.invalid)? '#397e36' : '#a52a2a'")
                        CheckmarkFilled
                div.text-left
                    span.mr-10 {{dataset.cve_id}}
                    span 上次修改 {{ new Date(dataset.modified_at ?? "").toLocaleString("zh-CN")}}
                template(#suffix)
                    NButton(size="small" @click="handleClick(task.detail, dataset.cve_id)") 标注
</template>

<script setup lang="ts">
import { datasetService } from '@/utils/services';
import { NIcon,NButton,NCollapse, NCollapseItem, NDivider, NListItem,NList } from 'naive-ui';
import { reactive,h,computed } from 'vue';
import { CheckmarkFilled, HelpFilled, WarningFilled } from "@vicons/carbon";
import { useRoute, useRouter } from 'vue-router';
import { simplifyDate } from "@/utils/others";
import { useDatasetsStore } from '@/stores/datasets';

const {data} =  await datasetService.getMyTask()
const tasks = data.map(e => {return {name: e.name, detail:e.detail, created_at: new Date(e.created_at)}})

const router = useRouter()
const route = useRoute()
const datasetsStore = useDatasetsStore()

const handleClick =(list, id) =>  {
    datasetsStore.initialize( list.map((e) => e.cve_id), id)
    router.push({name: "DatasetDetail", params:{id:id}})
    datasetsStore.savePrevPage(route.fullPath)
    }

</script>