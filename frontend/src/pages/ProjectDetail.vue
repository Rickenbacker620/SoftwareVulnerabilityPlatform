<template lang="pug">
NLayout(style="top: 64px;" position="absolute" has-sider)
    NLayoutSider(collapse-mode="width" show-trigger="bar" :collapsed-width="64" :width="150")
        NMenu(:options="menuOptions"
            :render-label="renderMenuLabel"
            :collapsed-width="64"
            :collapsed-icon-size="24")
    NLayoutContent(:native-scrollbar="false")
        div.overflow-auto.mx-10.my-10
            router-view
</template>

<script setup lang="ts">
import { datasetService } from "@/utils/services";
import { h, onMounted } from "vue";
import { NButton, NIcon } from "naive-ui";
import { RouterLink, useRoute, useRouter } from "vue-router";
import { WordCloud, ChartBar, Task } from "@vicons/carbon"
import { useUserStore } from "@/stores/user";
// import mockdataset from "../../utils/cveinfo.json"

function renderIcon(icon) {
    return () => h(NIcon, null, { default: () => h(icon) })
}

const menuOptions = [
    // {
    //     to: {
    //         name: "StatPanel"
    //     },
    //     label: "统计",
    //     key: "stat",
    //     icon: renderIcon(ChartBar)
    // },
    // TODO - add stastics
    {
        to: {
            name: "TaskList"
        },
        label: "任务",
        key: "task",
        icon: renderIcon(Task)
    },
]

const user = useUserStore()

if (user.isAdmin){
    menuOptions.unshift(
        {
            to: {
                name: "DatasetList",
            },
            label: "数据集",
            key: "dataset",
            icon: renderIcon(WordCloud)
        })
}
// if (["hlf", "xyc"].includes(user.username)) {
//     // TODO CHANGE THIS
//     menuOptions.push(
//         {
//             to: {
//                 name: "DatasetList",
//             },
//             label: "数据集",
//             key: "dataset",
//             icon: renderIcon(WordCloud)
//         })
// }


function renderMenuLabel(option) { return h(RouterLink, { to: option.to }, { default: () => option.label }) }

const route = useRoute()
const router = useRouter()
const projectId = route.params.id

// onMounted(async () => {
//     const dataset = (await datasetService.datasetList({ query: { project: 1 } })).data
// })
</script>
