<template lang="pug">
div.flex.flex-col.justify-center.items-center.mt-10.gap-5
    NUpload(action="/process_code/"
            @finish="handleFinish"
            :default-file-list="fileList"
            )
        NUploadDragger
            div(style="margin-bottom: 12px")
                NIcon(size="48" :depth="3")
                    ArchiveIcon
            NText(style="font-size: 16px") 拖动或点击上传代码文件
    NCard(class="w-2/3" title="分析图预览" v-if="showResult")
        template(#header-extra)
            NButton(type="primary" tag="a"
                    href="/analyze/zipped/output.tar.gz"
                    download) 下载
        NTabs
            NTabPane(v-for="graph in graphList" :name="graph" :tab="graph")
                img.mx-auto(:src="`/analyze/processed/1-${graph}.png`")
</template>

<script setup lang="ts">
import {
    NTabPane,
    NTabs,
    NUpload,
    NUploadDragger,
    NP,
    useMessage,
} from "naive-ui"
import type { UploadFileInfo } from "naive-ui"
import { Archive as ArchiveIcon, ArrowLeft, ArrowRight } from "@vicons/carbon"
import { ref } from "vue"

const message = useMessage()

const graphList = ["ast", "cdg", "cfg", "cpg", "ddg", "pdg"]

const showResult = ref(false)

const fileList = []


const handleFinish = ({
    file,
    event,
}: {
    file: UploadFileInfo
    event?: ProgressEvent
}) => {
    message.success(`${file.name}上传成功`)
    showResult.value = true
}

// const res = await axios.get("http://localhost:9000/docs")
// console.log(res)
</script>

<style>
.custom-arrow {
    @apply bg-black;
}
</style>