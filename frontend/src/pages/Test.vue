<!-- <template>
  <NDataTable
    remote
    ref="table"
    :columns="column"
    :data="data"
    :loading="loading"
    :pagination="pagination"
    :row-key="rowKey"
    @update:sorter="handleSorterChange"
    @update:filters="handleFiltersChange"
    @update:page="handlePageChange"
  />
</template>

<script>
import { defineComponent, ref, reactive, onMounted } from 'vue'

const column1 = {
  title: 'column1',
  key: 'column1',
  sorter: true,
  sortOrder: false
}

const column2 = {
  title: 'column2',
  key: 'column2',
  filter: true,
  filterOptionValues: [],
  filterOptions: [
    {
      label: 'Value1',
      value: 1
    },
    {
      label: 'Value2',
      value: 2
    }
  ]
}

// const columns = [
//   column1,
//   column2,
//   {
//     title: 'Column3',
//     key: 'column3'
//   }
// ]


const columns = [
    {
        title: 'CVE编号',
        key: 'cve_id',
        width: 150
    },
    {
        title: '标注日期',
        key: 'modified_at',
        width: 190,
        sorter: true,
        sortOrder: false
    },
    {
        title: '描述',
        key: 'description',
        ellipsis: true,
    },
    {
        title: '状态',
        key: 'actions',
        render(row) {
            const iconArr: any[] = []
            if (row.approved === true) {
                iconArr.push(
                    h(NIcon, { color: "#397e36", size: 20 }, { default: () => h(CheckmarkFilled) })
                )
            }
            if (row.ambiguous === true) {
                iconArr.push(
                    h(NIcon, { color: "#cab05c", size: 20 }, { default: () => h(HelpFilled) })
                )
            }
            if (row.annotated === true) {
                iconArr.push(
                    h(NIcon, { color: "#448faf", size: 20 }, { default: () => h(WarningFilled) })
                )
            }
            return iconArr;
        },
        width: 100
    },
    {
        title: '操作',
        key: 'actions',
        render(row: any) {
            return h(
                NButton,
                {
                    size: 'small',
                    onClick: () => { router.push({ name: 'DatasetDetail', params: { id: row.cve_id } }) }
                },
                { default: () => '查看' }
            )
        },
        ellipsis: true,
        width: 150
    },
]

const data = Array.apply(null, { length: 987 }).map((_, index) => {
  return {
    column1: index,
    column2: (index % 2) + 1,
    column3: 'a' + index
  }
})

function query (page, pageSize = 10, order = 'ascend', filterValues = []) {
  return new Promise((resolve) => {
    const copiedData = data.map((v) => v)
    const orderedData = order === 'descend' ? copiedData.reverse() : copiedData
    const filteredData = filterValues.length
      ? orderedData.filter((row) => filterValues.includes(row.column2))
      : orderedData
    const pagedData = filteredData.slice((page - 1) * pageSize, page * pageSize)
    const total = filteredData.length
    const pageCount = Math.ceil(filteredData.length / pageSize)
    setTimeout(
      () =>
        resolve({
          pageCount,
          data: pagedData,
          total
        }),
      1500
    )
  })
}

export default defineComponent({
  setup () {
    const dataRef = ref([])
    const loadingRef = ref(true)
    // const columnsRef = ref(columns)
    const column1Reactive = reactive(column1)
    const column2Reactive = reactive(column2)
    const paginationReactive = reactive({
      page: 1,
      pageCount: 1,
      pageSize: 10,
      prefix ({ itemCount }) {
        return `Total is ${itemCount}.`
      }
    })

    onMounted(() => {
      query(
        paginationReactive.page,
        paginationReactive.pageSize,
        column1Reactive.sortOrder,
        column2Reactive.filterOptionValues
      ).then((data) => {
        dataRef.value = data.data
        paginationReactive.pageCount = data.pageCount
        paginationReactive.itemCount = data.total
        loadingRef.value = false
      })
    })

    return {
      data: dataRef,
      column,
      column1: column1Reactive,
      column2: column2Reactive,
      pagination: paginationReactive,
      loading: loadingRef,
      rowKey (rowData) {
        return rowData.column1
      },
      handleSorterChange (sorter) {
        if (!sorter || sorter.columnKey === 'column1') {
          if (!loadingRef.value) {
            loadingRef.value = true
            query(
              paginationReactive.page,
              paginationReactive.pageSize,
              !sorter ? false : sorter.order,
              column2Reactive.filterOptionValues
            ).then((data) => {
              column1Reactive.sortOrder = !sorter ? false : sorter.order
              dataRef.value = data.data
              paginationReactive.pageCount = data.pageCount
              paginationReactive.itemCount = data.total
              loadingRef.value = false
            })
          }
        }
      },
      handleFiltersChange (filters) {
        if (!loadingRef.value) {
          loadingRef.value = true
          const filterValues = filters.column2 || []
          query(
            paginationReactive.page,
            paginationReactive.pageSize,
            column1Reactive.sortOrder,
            filterValues
          ).then((data) => {
            column2Reactive.filterOptionValues = filterValues
            dataRef.value = data.data
            paginationReactive.pageCount = data.pageCount
            paginationReactive.itemCount = data.total
            loadingRef.value = false
          })
        }
      },
      handlePageChange (currentPage) {
        if (!loadingRef.value) {
          loadingRef.value = true
          query(
            currentPage,
            paginationReactive.pageSize,
            column1Reactive.sortOrder,
            column2Reactive.filterOptionValues
          ).then((data) => {
            dataRef.value = data.data
            paginationReactive.page = currentPage
            paginationReactive.pageCount = data.pageCount
            paginationReactive.itemCount = data.total
            loadingRef.value = false
          })
        }
      }
    }
  }
})
</script> -->