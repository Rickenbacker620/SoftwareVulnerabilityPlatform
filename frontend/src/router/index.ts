import { createRouter, createWebHistory, RouteRecordRaw } from "vue-router";
import DatasetDetail from "@/components/datasets/DatasetDetail.vue";
import DatasetList from "@/components/datasets/DatasetList.vue";
import Login from "@/pages/Login.vue";
import TaskList from "@/components/datasets/TaskList.vue";
import { useUserStore } from "@/stores/user";
import Home from "@/pages/Home.vue"

const routes: Array<RouteRecordRaw> = [
    {
        path: "/",
        name: "Home",
        component: Home,
        children:[
        {
            path: "/datasets",
            name: "DatasetList",
            component: DatasetList,
        },
        {
            path: "task",
            name: "TaskList",
            component: TaskList,
        },
        ],
    },
    {
        path: "/dataset/:id",
        name: "DatasetDetail",
        component: DatasetDetail,
        props: route => ({ id: route.params.id as string }),
    },
    {
        path: "/user/login",
        name: "Login",
        component: Login,
    },
];

const router = createRouter({
    history: createWebHistory(),
    routes,
});

router.beforeEach(async (to, from, next) => {
    const token = localStorage.getItem("token");
    if (token) {
        const user = useUserStore();
        await user.getUserInfo();
    }
    if (to.name !== "Login" && !!!token) next({ name: "Login" });
    else next();
});

export default router;
