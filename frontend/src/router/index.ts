import { createRouter, createWebHistory, RouteRecordRaw } from "vue-router";
import ProjectList from "@/pages/ProjectList.vue";
import ProjectDetail from "@/pages/Home.vue";
import DatasetDetail from "@/components/dataset/DatasetDetail.vue";
import DatasetList from "@/components/dataset/DatasetList.vue";
import Login from "@/pages/Login.vue";
import Test from "@/pages/Test.vue";
import TaskList from "@/components/dataset/TaskList.vue";
import { useUserStore } from "@/stores/user";
import Home from "@/pages/Home.vue"

const routes: Array<RouteRecordRaw> = [
    {
        path: "/",
        name: "Home",
        component: Home,
        children:[
        {
            path: "/datasets",
            name: "DatasetList",
            component: DatasetList,
        },
        {
            path: "task",
            name: "TaskList",
            component: TaskList,
        },
        ],
    },
    {
        path: "/dataset/:id",
        name: "DatasetDetail",
        component: DatasetDetail,
        props: (route) => ({ id: parseInt(route.params.id as string) }),
    },
    {
        path: "/user/login",
        name: "Login",
        component: Login,
    },
    // {
    //     path: "/user/register",
    //     name: "Register",
    //     component: Register,
    // },
    {
        path: "/test",
        name: "Test",
        component: Test,
    },
];

const router = createRouter({
    history: createWebHistory(),
    routes,
});

router.beforeEach(async (to, from, next) => {
    const token = localStorage.getItem("token");
    if (token) {
        const user = useUserStore();
        await user.getUserInfo();
    }
    if (to.name !== "Login" && !!!token) next({ name: "Login" });
    else next();
});

export default router;
