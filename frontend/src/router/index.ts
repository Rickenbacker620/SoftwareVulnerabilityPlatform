import { createRouter, createWebHistory, RouteRecordRaw } from "vue-router";
import ProjectList from "@/pages/ProjectList.vue";
import ProjectDetail from "@/pages/ProjectDetail.vue";
import DatasetDetail from "@/components/dataset/DatasetDetail.vue";
import DatasetList from "@/components/dataset/DatasetList.vue";
import Login from "@/pages/Login.vue";
// import Register from "@/components/user/Register.vue";
import StatPanel from "@/components/project/StatPanel.vue";
import Test from "@/pages/Test.vue";
import TaskList from "@/components/dataset/TaskList.vue";
import { useUserStore } from "@/stores/user";

const routes: Array<RouteRecordRaw> = [
    {
        path: "/projects",
        name: "ProjectList",
        component: ProjectList,
    },
    {
        path: "/projects/:id",
        name: "ProjectDetail",
        component: ProjectDetail,
        children: [
            {
                path: "datasets",
                name: "DatasetList",
                component: DatasetList,
            },
            {
                path: "stat",
                name: "StatPanel",
                component: StatPanel,
            },
            {
                path: "task",
                name: "TaskList",
                component: TaskList,
            },
        ],
    },
    {
        path: "/dataset/:id",
        name: "DatasetDetail",
        component: DatasetDetail,
        props: (route) => ({ id: parseInt(route.params.id as string) }),
    },
    {
        path: "/user/login",
        name: "Login",
        component: Login,
    },
    // {
    //     path: "/user/register",
    //     name: "Register",
    //     component: Register,
    // },
    {
        path: "/test",
        name: "Test",
        component: Test,
    },
];

const router = createRouter({
    history: createWebHistory(),
    routes,
});

router.beforeEach((to, from, next) => {

    const user = useUserStore();
    console.log(user)

    if (to.name !== "Login" && !!!localStorage.getItem("token"))
        next({ name: "Login" });
    else next();
});


export default router;
