import { createApp } from "vue";
import SiteRoot from "./SiteRoot.vue";
import naive from "./utils/naive-ui";
import router from "./router";
import "./assets/tailwind.css";
import { createPinia } from "pinia";
import axios from "axios";
import "vfonts/Lato.css";
import "vfonts/FiraCode.css";
import { useUserStore } from "./stores/user";

axios.interceptors.request.use(
    (config) => {
        let token = localStorage.getItem("token");
        if (token) {
            config.headers!.Authorization = `Bearer ${token}`;
        }
        return config;
    },
    (error) => {
        return Promise.reject(error);
    }
);

createApp(SiteRoot).use(createPinia()).use(router).use(naive).mount("#app");

const user = useUserStore();

router.beforeEach((to, from, next) => {
    if (to.name !== "Login" && !!!localStorage.getItem("token"))
        next({ name: "Login" });
    else next();
});
