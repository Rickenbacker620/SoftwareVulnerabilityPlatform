FROM node:alpine as builder

WORKDIR /frontend

COPY package.json .
COPY package-lock.json .

RUN npm ci
COPY . .

RUN npm run build

FROM openapitools/openapi-generator-cli as api-gen

WORKDIR /frontend

COPY --from=builder /frontend .

ENTRYPOINT [ "/usr/local/bin/openapi-generator" ]

CMD ["-i","backend:12355/openapi.json", "-g" ,"typescript-axios", "-o", "./src/api"]

FROM nginx:alpine

COPY --from=api-gen /frontend/dist /usr/share/nginx/html