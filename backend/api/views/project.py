from django.contrib.auth.models import AnonymousUser
from ..models.project import Dataset, Project
from rest_framework import viewsets
from ..serializers.project import DatasetSerializer, ProjectSerializer


class ProjectViewSet(viewsets.ModelViewSet):
    serializer_class = ProjectSerializer
    pagination_class = None

    def get_queryset(self):
        if self.request.user.is_anonymous:
            return Project.objects.all()
        else:
            return self.request.user.projects.all()


class DatasetViewSet(viewsets.ModelViewSet):
    serializer_class = DatasetSerializer
    pagination_class = None

    def get_queryset(self):
        project = self.request.query_params.get('project')
        queryset = Dataset.objects.all()
        if project is not None:
            return queryset.filter(project=project)
        return queryset
