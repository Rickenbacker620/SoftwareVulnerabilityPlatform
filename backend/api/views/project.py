from django.contrib.auth.models import AnonymousUser
import rest_framework
from ..models.project import Dataset, Project
from rest_framework import serializers, viewsets
from ..serializers.project import DatasetDetailSerializer, DatasetSerializer, ProjectSerializer


class ProjectViewSet(viewsets.ModelViewSet):
    serializer_class = ProjectSerializer
    pagination_class = None

    def get_queryset(self):
        if self.request.user.is_anonymous:
            return Project.objects.all()
        else:
            return self.request.user.projects.all()


class DatasetViewSet(viewsets.ModelViewSet):
    serializer_class = DatasetSerializer
    pagination_class = None

    def list(self, request, *args, **kwargs):
        self.serializer_class = DatasetSerializer
        return super().list(request, *args, **kwargs)

    def retrieve(self, request, *args, **kwargs):
        self.serializer_class = DatasetDetailSerializer
        return super().retrieve(request, *args, **kwargs)

    def get_queryset(self):
        project = self.request.query_params.get('project')
        queryset = Dataset.objects.all()
        if project is not None:
            return queryset.filter(project=project)
        return queryset
