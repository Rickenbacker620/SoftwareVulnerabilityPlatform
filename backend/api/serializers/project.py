from ..models.role import RoleMapping, Role
from django.db.models.fields.related import RelatedField
from rest_framework import serializers
from rest_framework.relations import PrimaryKeyRelatedField
from ..models.project import *


class ProjectSerializer(serializers.ModelSerializer):
    # users = UserSerializer(many=True, read_only=True)
    users = PrimaryKeyRelatedField(many=True, read_only=True)

    def create(self, validated_data):
        project = Project.objects.create(**validated_data)
        user = self.context['request'].user
        role = Role.objects.get(name='project_admin')
        RoleMapping.objects.create(project=project, user=user, role=role)
        return project

    class Meta:
        model = Project
        fields = ('id', 'name', 'description', 'guideline', 'updated_at', 'users')


class CVEInfoSerializer(serializers.ModelSerializer):
    class Meta:
        model = CVEInfo
        fields = '__all__'


class DatasetDetailSerializer(serializers.ModelSerializer):
    cve = CVEInfoSerializer()

    class Meta:
        model = Dataset
        fields = '__all__'


class DatasetSerializer(serializers.ModelSerializer):
    class Meta:
        model = Dataset
        fields = '__all__'
