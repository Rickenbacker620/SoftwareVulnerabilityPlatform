from pymongo import MongoClient
import json


def get_database():
    # Provide the mongodb atlas url to connect python to mongodb using pymongo
    CONNECTION_STRING = "mongodb://47.116.73.52"

    # Create a connection using MongoClient. You can import MongoClient or use pymongo.MongoClient
    client = MongoClient(CONNECTION_STRING)

    # Create the database for our example (we will use the same database throughout the tutorial
    return client["svp"]


def reshape(document):
    return {
        "cve_id": document["_id"],
        "description": document["description"],
        "annotations": document["annotation"]["annotations"]
    }

if __name__ == '__main__':
    db = get_database()
    documents = db['datasets'].find(
        {"annotation": {"$exists": True}, "annotation.annotations": {"$not": {"$size": 0}}})
    with open("export.jsonl", "w+") as file:
        for document in documents:
            out = reshape(document)
            dumped = json.dumps(out) + "\n"
            file.write(dumped)