from fastapi import Depends
from pydantic import BaseModel
from tortoise import fields


class TimestampMixin:
    created_at = fields.DatetimeField(null=True, auto_now_add=True)
    modified_at = fields.DatetimeField(null=True, auto_now=True)


class TokenPayloadSchema(BaseModel):
    sub: str
    exp: str


class TokenSchema(BaseModel):
    access_token: str
    token_type: str


class Status(BaseModel):
    message: str


class PaginationParams(BaseModel):
    offset: int = 0
    limit: int = 20


class DatasetFilterParam(BaseModel):
    page: PaginationParams = Depends()
    annotated: bool | None
    ambiguous: bool | None
    approved: bool | None
    invalid: bool | None
    example: bool | None
    classified: bool | None
    order: int | None
    q: str = ""

    @property
    def status_dict(self) -> dict:
        status_dict = self.__dict__.copy()
        status_dict.pop("order")
        status_dict.pop("q")
        status_dict.pop("page")
        return status_dict
