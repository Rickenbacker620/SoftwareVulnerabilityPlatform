from tortoise import fields, models

from .dataset import CVEInfo
from .extra import TimestampMixin
from .user import User


class PartCategory(models.Model):
    text = fields.CharField(max_length=100)
    text_zh = fields.CharField(max_length=100)


class DetailCategory(models.Model):
    text = fields.CharField(max_length=100)
    text_zh = fields.CharField(max_length=100)

    part: fields.ForeignKeyNullableRelation[PartCategory] = fields.ForeignKeyField(
        'models.PartCategory',
        on_delete=fields.SET_NULL,
        null=True
    )


class Annotation(models.Model):
    start_offset = fields.IntField()
    end_offset = fields.IntField()

    user: fields.ForeignKeyRelation[User] = fields.ForeignKeyField(
        'models.User',
        on_delete=fields.CASCADE
    )
    cve: fields.ForeignKeyRelation[CVEInfo] = fields.ForeignKeyField(
        'models.CVEInfo',
        on_delete=fields.CASCADE,
        related_name='annotations'
    )
    part: fields.ForeignKeyRelation[PartCategory] = fields.ForeignKeyField(
        'models.PartCategory',
        on_delete=fields.CASCADE
    )
    detail: fields.ForeignKeyNullableRelation[DetailCategory] = fields.ForeignKeyField(
        'models.DetailCategory',
        null=True,
        on_delete=fields.SET_NULL
    )
