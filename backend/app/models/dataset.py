from tortoise import fields, models

from .extra import TimestampMixin
from .user import User


class CVEInfo(models.Model):
    cve_no = fields.CharField(max_length=64, pk=True)
    description = fields.TextField()
    publisheddate = fields.DatetimeField()
    lastmodified = fields.DatetimeField()
    cvss3_score = fields.CharField(max_length=16)
    cvss3_type = fields.CharField(max_length=16)
    cvss2_score = fields.CharField(max_length=16)
    cvss2_type = fields.CharField(max_length=16)
    source_link_list = fields.TextField()
    github_link_lisk = fields.TextField()
    cpe_dlist = fields.TextField()


class Dataset(models.Model, TimestampMixin):
    cve: fields.OneToOneRelation[CVEInfo] = fields.OneToOneField(
        'models.CVEInfo', on_delete=fields.CASCADE, pk=True)

    name = fields.CharField(max_length=30)

    user: fields.ForeignKeyRelation[User] = fields.ForeignKeyField(
        'models.User',
        on_delete=fields.SET_NULL,
        null=True,
        blank=True
    )

    approved = fields.BooleanField(default=False)
    ambiguous = fields.BooleanField(default=False)

    class Meta:
        unique_together = ("cve", "user")

