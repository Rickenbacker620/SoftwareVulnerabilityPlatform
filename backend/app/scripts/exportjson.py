import pymongo
from pymongo import MongoClient
import json

def get_database():

    # Provide the mongodb atlas url to connect python to mongodb using pymongo
    CONNECTION_STRING = "mongodb://localhost"

    # Create a connection using MongoClient. You can import MongoClient or use pymongo.MongoClient
    client = MongoClient(CONNECTION_STRING)

    # Create the database for our example (we will use the same database throughout the tutorial
    return client["svp"]


def shape_data(data):
	return {
		"cve_id": data["_id"],
		"description": data["description"],
		"annotations": data["annotation"]["annotations"]
	}


db = get_database()
collection = db["dataset"]
docs = collection.find({"annotation": {"$exists": True}})
i = 0
with open('test.jsonl','w') as file:
	for doc in docs:
		doc = shape_data(doc)
		js = json.dumps(doc)
		file.write(js)
		file.write('\n\n')