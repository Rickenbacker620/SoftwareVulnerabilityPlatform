from typing import Optional

from pydantic import BaseModel
from tortoise.contrib.pydantic import pydantic_model_creator
from datetime import datetime

from app.models import Dataset, CVEInfo, User


class DatasetSchema(BaseModel):
    class CVEInfoSimpleSchema(BaseModel):
        cve_no: str
        publisheddate: datetime
        lastmodified:  datetime
        description: str

        class Config:
            orm_mode = True

    id: int
    cve: CVEInfoSimpleSchema

    class Config:
        orm_mode = True


class DatasetDetailSchema(BaseModel):
    CVEInfoSchema = pydantic_model_creator(CVEInfo, name="CVEInfoSchema", exclude_readonly=True)
    UserSchema = pydantic_model_creator(User, name="UserSchema", exclude_readonly=True)

    cve: CVEInfoSchema
    annotations_approved_by: Optional[UserSchema]

    class Config:
        orm_mode = True


DatasetCreateSchema = pydantic_model_creator(Dataset)
