from datetime import datetime
from typing import Optional

from .extra import ORMModel
from tortoise.contrib.pydantic import pydantic_model_creator

from app.models import Dataset, CVEInfo, User


class DatasetSchema(ORMModel):
    cve_id: str
    approved: Optional[bool]
    ambiguous: Optional[bool]
    description: str
    last_modified: Optional[datetime]




class DatasetDetailSchema(ORMModel):
    CVEInfoSchema = pydantic_model_creator(CVEInfo, name="CVEInfoSchema", exclude_readonly=True)
    UserSchema = pydantic_model_creator(User, name="UserSchema", exclude_readonly=True)

    id: int
    cve: CVEInfoSchema
    annotations_approved_by: Optional[UserSchema]


DatasetCreateSchema = pydantic_model_creator(Dataset)


class AnnotationTaskSchema(ORMModel):
    name: str
    dataset: DatasetSchema
    done: bool


class AnnotationTaskCreateSchema(ORMModel):
    name: str
    size: int
